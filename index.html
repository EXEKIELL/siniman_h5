<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <title>诗尼曼15周年庆</title>
    <link rel="stylesheet" href="__COUPON__/css/reset.css" />
    <link rel="stylesheet" href="__COUPON__/css/animate.min.css">
    <link rel="stylesheet" href="__COUPON__/css/index.css">
    <script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script>
        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: "<{$signPackage['appId']}>", // 必填，公众号的唯一标识
            timestamp: "<{$signPackage['timestamp']}>", // 必填，生成签名的时间戳
            nonceStr: "<{$signPackage['nonceStr']}>", // 必填，生成签名的随机串
            signature: "<{$signPackage['signature']}>",// 必填，签名，见附录1
            jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });
        wx.ready(function () {
            share();
        });


        // 分享功能
        function setShare(){

        }
        function share(){
            wx.onMenuShareTimeline({
                title: '诗尼曼15周年庆',
                desc: '购15周年纪念卡，尊享两重特惠',
                link: "http://juice.hengdikeji.com/coupon/home",
                imgUrl: 'http://juice.hengdikeji.com/temp/coupon/index/img/shareImg.png',

                trigger: function (res) {
                },
                success: function (res) {
                    $('#maskErWei').css({
                        display:'flex'
                    });
                    $('#maskErWei').on('click',function(){
                        $('#maskErWei').hide();
                    })
                },
                cancel: function (res) {
                },
                fail: function (res) {
                }
            });
            wx.onMenuShareAppMessage({
                title: '诗尼曼15周年庆',
                desc: '购15周年纪念卡，尊享两重特惠',
                link: "http://juice.hengdikeji.com/coupon/home",
                imgUrl: 'http://juice.hengdikeji.com/temp/coupon/index/img/shareImg.png',
                trigger: function (res) {
                },
                success: function (res) {
                    $('#maskErWei').css({
                        display:'flex'
                    });
                    $('#maskErWei').on('click',function(){
                        $('#maskErWei').hide();
                    })
                },
                cancel: function (res) {
                },
                fail: function (res) {
                }
            });
        }
    </script>
    <div style="display: none">
        <script src="https://s22.cnzz.com/z_stat.php?id=1273713078&web_id=1273713078" language="JavaScript"></script>
    </div>
    <style>
        #app #popUp1{
            z-index: 999;
        }
         #sharePopUp{
             display: block !important;
         }
        .inline{
            background: url(__COUIMG__/img/bj08.png) no-repeat;
            background-size:cover;
            height: 1.2rem;
            width: 3rem !important;
            margin-top: 0.17rem;
            margin-bottom: 0.17rem;
        }
        .inline select{
            margin: 0 auto;
        }
    </style>
    <!--rem单位-->
    <script>
        (function(doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function() {
                    var clientWidth = docEl.clientWidth;
                    if(!clientWidth) return;
                    if(clientWidth >= 750) {
                        docEl.style.fontSize = '100px';
                    } else {
                        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                    }
                };

            if(!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>

    <link rel="stylesheet" href="__GROUP__/layui/css/layui.mobile.css">
    <script src="__GROUP__/layui/layui.js"></script>
    <script type="text/javascript">
        var imgpath='__COUIMG__';
    </script>
</head>
<body style="position: fixed;width: 100%;height: 100%;top: 0;left: 0;">
    <div id="app">
        <!--加载页-->
        <div id="load" v-if="idx == 0">
            <div class="list1"><img src="__COUIMG__/img/loadLogo.png" alt=""></div>
            <div class="list2 animated bounceIn"><img src="__COUIMG__/img/loadImg01.png" alt=""></div>
            <div class="list3">
                <div>
                    <img src="__COUIMG__/img/loading01.png" alt="">
                    <img class="loading" src="__COUIMG__/img/loading02.png" alt="">
                </div>
            </div>
            <div class="list4">
                <span>{{num}}%</span>
            </div>
        </div>
        <!--首页-->
        <div id="index" v-if="idx == 1">

            <div class="img01"><img src="__COUIMG__/img/logo.png" alt=""></div>
            <div class="img02" ><img src="__COUIMG__/img/img02.png" alt=""/></div>
            <div class="img03" ><img src="__COUIMG__/img/img03.png" alt=""/></div>
            <div class="img04" ><img src="__COUIMG__/img/img04.png" alt=""/></div>
            <div class="img05" ><img src="__COUIMG__/img/img05.png" alt=""/></div>
            <div class="img06"><img src="__COUIMG__/img/img01.png" alt=""></div>

            <div class="img07" v-on:click="mycoupone()">
                <img :src="status==0?'__COUIMG__/img/button01.png':'__COUIMG__/img/button02.png'" alt="">
            </div>

            <div class="img08" v-on:click="popUp=2"><img src="__COUIMG__/img/left01.png" alt=""></div>

            <div class="img09" v-on:click="winList(0,null)" key="0"><img src="__COUIMG__/img/left02.png" alt=""></div>
            <div class="img10" v-on:click=""><img src="__COUIMG__/img/img06.png" alt=""></div>

        </div>
        <!--购买成功-->
        <div id="paySuccess" v-if="idx == 2">
            <div class="list1">
                <img src="__COUIMG__/img/img08.png" alt="">
            </div>
            <div class="list2">
                <img src="__COUIMG__/img/card.png" alt="">
            </div>
            <div class="list3">
                <img src="__COUIMG__/img/img09.png" alt="">
            </div>

            <div class="list4" v-on:click="idx=6">
                <img src="__COUIMG__/img/button04.png" alt="">

            </div>
        </div>

        <!--6月16日公布中奖名单-->
        <div id="index1" v-if="idx == 3">
            <div class="list1">
                <img src="__COUIMG__/img/img11.png" alt="">
            </div>

            <div class="list2" v-if="code">
                <div>
                    <span>您的抽奖码：{{ code }}</span>
                </div>
            </div>

            <div class="list3">
                <div>
                    <img src="https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=<{$Qcode}>" alt="">
                </div>
            </div>
            <div class="list4">
                <img src="__COUIMG__/img/img13.png" alt="">
            </div>
            <div class="list5">
                <div>
                    <div v-on:click="idx=1">
                        <img src="__COUIMG__/img/button05.png" alt="">
                    </div>
                    <div v-on:click="popUp=0">
                        <img src="__COUIMG__/img/button06.png" alt="">
                    </div>
                </div>
            </div>
        </div>
        <!--信息提交成功-->
        <div id="index2" v-if="idx == 4">
            <div class="list1">
                <img src="__COUPON__/img/img14.png" alt="">
            </div>
            <div class="list2">
                <div>
                    <span>您的抽奖码：{{ code }}</span>
                </div>
            </div>
            <div class="list3">
                <div>
                    <img src="https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=<{$Qcode}>" alt="">
                </div>
            </div>
            <div class="list4">
                <img src="__COUPON__/img/img13.png" alt="">
            </div>
            <div class="list5">
                <div>
                    <div v-on:click="idx=1">
                        <img src="__COUPON__/img/button07.png" alt="">
                    </div>
                </div>
            </div>
        </div>
        <!--我的卡券-->
        <div id="index3" v-if="idx == 5">
            <div class="list1">
                <img src="__COUPON__/img/img15.png" alt="">
            </div>
            <div class="list2">
                <div>
                    <span>您的抽奖码：{{ code }}</span>
                </div>
            </div>
            <div class="list3">
                <div>
                    <img src="https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=<{$Qcode}>" alt="">
                </div>
            </div>
            <div class="list4">
                <img src="__COUPON__/img/img13.png" alt="">
            </div>
            <div class="list5">
                <div>
                    <div v-on:click="idx=1">
                        <img src="__COUPON__/img/button05.png" alt="">
                    </div>
                </div>
            </div>
        </div>
        <!--填写个人信息-->
        <div id="message" v-if="idx == 6">
            <div class="list1" v-on:click="idx=1">
                <img src="__COUPON__/img/button08.png" alt="">
            </div>
            <div class="list2">
                <img src="__COUPON__/img/title01.png" alt="">
            </div>
            <div class="input">
                <div class="inwrap">
                    <div class="input1">
                        <div>
                            <span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span>

                            <input type="text" name="uname"  placeholder="请输入姓名">

                        </div>
                    </div>
                    <div class="input2">
                        <div>
                            <span>电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话：</span>
                            <input type="text" name="mobile" placeholder="请输入11位手机号码">

                        </div>
                    </div>
                    <div class="input3" style="background: none">
                        <div style="margin-left: 0;width: 98%">
                            <div class="inline">
                                <select name="province" id="province" v-on:change="region('province',1,'city')">
                                    <option value="">请选择省份</option>
                                    <option value="1">北京</option>
                                    <option value="2">广东省</option>
                                </select>
                            </div>
                            <div class="inline">
                                <select name="city" id="city" v-on:change="region('city',2,'area')">
                                    <option value="">请选择城市</option>
                                </select>
                            </div>

                            <div class="inline">
                                <select name="area" id="area"  v-on:change="getShop()">
                                    <option value="">请选择地区</option>
                                </select>
                            </div>

                            <!--<div class="icon"></div>-->
                        </div>
                    </div>
                    <div class="input4">
                        <div style="font-size: 0">
                            <span>门&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;店：</span>
                            <divs style="width: 70%">
                                <select name="shop" id="shop" style="width: 100%">
                                    <option value="">请选择门店</option>
                                    <option v-for="item in shops" :value="item.id">{{ item.name }}</option>
                                </select>
                            </divs>

                            <div class="icon"></div>
                        </div>
                    </div>
                    <div class="input5">
                        <div style="font-size: 0">
                            <span>定制产品：</span>
                            <div style="width: 70%">
                                <select name="address" id="" placeholder="请选择" style="width: 100%">
                                    <option value="全屋定制">全屋定制</option>
                                    <option value="橱柜">橱柜</option>
                                    <option value="门窗">门窗</option>
                                </select>
                            </div>

                            <div class="icon"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list3">
                <div v-on:click="edit()">
                    <img src="__COUPON__/img/button03.png" alt="">
                </div>
            </div>
        </div>
        <!--中奖名单-->
        <div id="winList" v-if="idx == 7">
            <div class="list1" v-on:click="idx=1">
                <img src="__COUPON__/img/button08.png" alt="">
            </div>
            <div class="list2">
                <img src="__COUPON__/img/title02.png" alt="">
            </div>
            <div class="list3">
                <img src="__COUPON__/img/img16.png" alt="">
            </div>
            <div class="list4">
                <div class="wrap">
                    <div class="nav">
                        <div v-for="(item,index) in awardList" :key="index" :class="item.className" @click="winList(index,item.type)"></div>
                    </div>
                    <div class="cont">
                        <template v-if="winners">
                            <div class="c1" v-for="item in winners">
                                <div>
                                    <div>
                                        <div>
                                            <img :src="item.headimgurl" alt="">
                                        </div>
                                    </div>
                                    <div>
                                        <div>
                                            <img v-if="item.type==0" src="__COUPON__/img/top.png" alt="">
                                            <img v-if="item.type==1" src="__COUPON__/img/top1.png" alt="">
                                            <img v-if="item.type==2" src="__COUPON__/img/top2.png" alt="">
                                            <img v-if="item.type==3" src="__COUPON__/img/top3.png" alt="">
                                        </div>
                                        <div>
                                            <span>{{ item.uname }} 来自{{ item.source }} {{ item.mobile }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template v-else>
                            <div class="c1">
                                <div>
                                    还没有名单
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        <!--分享页弹窗-->
        <div id="sharePopUp" v-if="popUp == 0" v-on:click="popUp=1">
            <div>
                <img src="__COUIMG__/img/share01.png" alt="">
            </div>
        </div>
        <!--活动说明弹窗-->
        <div id="activityDesc" v-if="popUp == 2">
            <div>
                <div class="wrap">
                    <div class="list1">
                        <img src="__COUIMG__/img/img07.png" alt="">
                    </div>
                    <div class="list2">
                        <div v-on:click="popUp=1">
                            <img src="__COUIMG__/img/button03.png" alt="">
                        </div>
                    </div>
                    <div class="list3" v-on:click="popUp=1">
                        <img src="__COUIMG__/img/icon01.png" alt="">
                        <div></div>

                    </div>
                </div>
            </div>

        </div>
        <!--提交失败弹窗-->
        <div id="popUp1" v-if="popUp == 3">
            <div class="wrap">
                <div>
                    <div class="list1">
                        <img src="__COUIMG__/img/img10.png" alt="">
                        <img class="dashed" src="__COUIMG__/img/dashed.png" alt="">
                    </div>
                    <div class="list2">
                        <span>{{ msg }}</span>
                    </div>

                    <div class="list3" v-on:click="popUp=1">
                        <img src="__COUIMG__/img/button03.png" alt="">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        layui.use('layer', function(){
            var layer = layui.layer;
        });
        var App = new Vue({
            el:'#app',
            data:{
                idx:0,
                num:1,
                timer1:null,
                //按钮状态
                button:false,
                popUp:1,
                token:'<{$token}>',
                msg:'',
                step:'<{$step}>',
                status:'<{$status}>',
                code:"<{$coupon['code']}>",
                awardList:[
                    {className:'top1 sel',isSel:false,type:0},
                    {className:'top2',isSel:false,type:1},
                    {className:'top3',isSel:false,type:2},
                    {className:'top4',isSel:false,type:3}
                ],
                shops:[],
                winners:[]
            },


            watch:function(){

            },
            updated:function(){
                this.$nextTick(function () {
                    $('#app #sharePopUp,#app #activityDesc,#app #popUp1').show();
                });
            },

            mounted:function () {

                var _this=this;
                if(_this.step==2){
                    _this.idx=6;
                }
                $('#sharePopUp').css({
                    'display':'block'
                });
                this.$nextTick(function () {
                    //弹窗加载
                    if(this.idx == 1){
                        $('#index .img02,#index .img04,#index .img03,#index .img05,#index .img10,#index .img06,#index .img07').hide();
                        $('#index .img02').show().addClass('animated bounceIn')
                        setTimeout(function () {
                            $('#index .img04').show().addClass('animated bounceIn')
                        },100)
                        setTimeout(function () {
                            $('#index .img03').show().addClass('animated bounceIn')
                        },300)
                        setTimeout(function () {
                            $('#index .img05').show().addClass('animated bounceIn')
                        },600)
                        setTimeout(function () {
                            $('#index .img10').show().addClass('animated bounceIn')
                        },1000)
                        setTimeout(function () {
                            $('#index .img06').show().addClass('animated bounceIn')
                        },1000)
                        setTimeout(function () {
                            $('#index .img07').show().addClass('animated bounceIn')
                        },1200)
                    }
                    //加载
                    if(this.idx == 0){
                        const that = this
                        this.timer1 = setInterval(function () {
                            if(that.num>100){
                                that.idx = 1
                                clearInterval(that.timer1)
                            }else{
                                that.num++;
                                $('#load .loading').css('width',that.num+'%')
                            }
                        },10)
                    }
                })
            },
            methods:{

                /*中奖名单*/
                winList:function(index,type){
                    var _this=this;
                    var e = event.target;
                    $(e).parent('.nav').find('div').removeClass('sel');
                    $(e).addClass('sel');

                    var url="<{:url('coupon/winList')}>";
                    $.get(url,{type:type},function (res) {
                        if(!res && _this.idx==1){
                            _this.idx=3;
                        }else{
                            _this.idx=7;
                            if(res.length>=1){
                                _this.winners=res;
                            }else{
                                _this.winners=false;
                            }

                        }
                    },'JSON');
                },
                buy:function(){
                    layer.load(2,{
                        shade:0.6
                    });
                    var url="<{:url('coupon/create')}>";
                    var _this=this;
                    $.post(url,{
                        __token__:_this.token
                    },function(res){
                        layer.closeAll();
                        _this.token=res.token;

                        if(res.code==0){
                            _this.popUp=3;
                            _this.msg=res.msg;
                        }else{
                            window.location.href=res.url;
                        }
                    },'JSON');
                },
                mycoupone:function(){
                    var _this=this;
                    var status=parseInt(_this.status);
                    switch (status){
                        case 0:
                            _this.buy();
                            break;
                        case 1:
                            _this.idx=6;
                            break;
                        case 2:
                            _this.idx=5;
                            break;
                        default:
                            _this.idx=3;
                            break;
                    }
                },
                edit:function(){
                    layer.load(2,{
                        shade:0.6
                    });
                    var _this=this;
                    var uname=$('[name="uname"]').val();
                    var mobile=$('[name="mobile"]').val();
                    var province=$('[name="province"]').text();
                    var city=$('[name="city"]').text();
                    var area=$('[name="area"]').text();
                    var shop=$('[name="shop"]').val();
                    var address=$('[name="address"]').val();
                    var url="<{:url('coupon/update')}>";
                    $.post(url,{
                        __token__:_this.token,
                        uname:uname,
                        mobile:mobile,
                        province:province,
                        city:city,
                        area:area,
                        shop:shop,
                        address:address,
                        id:"<{$coupon['id']}>"
                    },function(res){
                        layer.closeAll();
                        _this.token=res.token;
                        if(res.code==0){
                            _this.popUp=3;
                            _this.msg=res.msg;
                        }else{
                           _this.code=res.mycode;
                           _this.idx=4;
                           _this.status=2;
                        }
                    },'JSON')
                },
                region:function(div,type,obj){
                    var url="<{:url('coupon/region')}>";
                    var val=$('#'+div).val();
                    $.get(url,{
                        id:val,
                        type:type
                    },function(res){
                        $('#'+obj).html(res.list);
                        if(type==1){
                            $('#area').html(res.list2);
                        }
                    },'JSON');
                },
                getShop:function () {
                    var _this=this;
                    var province=$('#province').val();
                    var city=$('#province').val();
                    var area=$('#area').val();
                    var url="<{:url('coupon/getshop')}>";
                    $.get(url,{
                        province:province,
                        city:city,
                        area:area,
                    },function (res) {
                        _this.shops=res;
                    },'JSON');
                }
            }
        })
    </script>
</body>
</html>